:
# Copyright @ 2017 Michael P. Reilly. All rights reserved.

# uses bitbucket_repos - list of repository names under {org}, e.g. "repo1 repo2 repo3"
# uses bitbucket_org - Arcege or whichever user/organization in bitbucket
# uses bitbucket_pull_on_enter - non-empty (true) or empty (false)
# uses bitbucket_push_on_leave - non-empty (true) or emtpy (false)

if [ -n "$bitbucket_repos" -a -n "$bitbucket_org" ]; then
    case ${wshook__op} in
        create)
            for reponame in $bitbucket_repos; do
                case $reponame in
                    *:*)  # has a branch
                          ref=${reponame#*:}
                          reponame=${reponame%%:*}
                          /usr/bin/hg clone --rev ${ref} ssh://hg@bitbucket.org/${bitbucket_org}/${reponame} \
                              $wshook__workspace/${reponame}
                          ;;
                    *)
                          /usr/bin/hg clone ssh://hg@bitbucket.org/${bitbucket_org}/${reponame} \
                              $wshook__workspace/${reponame}
                          ;;
                esac
            done
            unset reponame
            ;;
        enter)
            if [ -n "$bitbucket_pull_on_enter" ]; then
                for reponame in $bitbucket_repos; do
                    case $reponame in
                        *:*)  # has a branch
                              reponame=${reponame%%:*}
                    esac
                    /usr/bin/hg -R $wshook__workspace/${reponame} pull
                done
                unset reponame
            fi
            ;;
        leave)
            if [ -n "$bitbucket_push_on_leave" ]; then
                for reponame in $bitbuck_repos; do
                    case $reponame in
                        *:*)  # has a branch
                              reponame=${reponame%%:*}
                    esac
                    /usr/bin/hg -R $wshook__workspace/${reponame} push
                done
                unset reponame
            fi
            ;;
    esac
fi
