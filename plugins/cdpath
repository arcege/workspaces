:
# Copyright @ 2017 Michael P. Reilly. All rights reserved.

# This adds the workspace to the end of CDPATH and
# creates a 'cd' function that changes the context
# of "HOME" to the workspace

# uses cdpath_startdir - change to a specific directory before entering

case ${wshook__op} in
    enter)
        if [ $_ws_shell = zsh ]; then
            setopt -o auto_cd
            cdpath=()
        else
            export CDPATH="${CDPATH}:$WORKSPACE"
        fi
        CDHOME="$WORKSPACE"
        cd () { [ $# -eq 0 ] && builtin cd ${CDHOME} || builtin cd "$@"; }
        if [ -z "${wshook__retdir}" -a -n "$cdpath_startdir" ]; then
            cd ${cdpath_startdir}
        fi
        ;;
    leave)
        CDPATH="${CDPATH%:*}"
        unset CDHOME
        if [ $_ws_shell = bash ]; then
            if [ $(type -t cd) = function ]; then
                unset cd
            fi
        elif [ $_ws_shell = zsh ]; then
            if [ "$(whence -v cd)" = "cd is a shell function" ]; then
                unset -f cd
            fi
        fi
        ;;
esac
